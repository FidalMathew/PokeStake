import { checkSettingsValid, } from "mpc-framework-common";
import EmpWasmSession from "./EmpWasmSession";
export default class EmpWasmBackend {
    run(circuit, mpcSettings, name, input, send) {
        const checkResult = (checkSettingsValid(circuit, mpcSettings, name, input) ??
            checkSettingsValidForEmpWasm(circuit, mpcSettings));
        if (checkResult !== undefined) {
            throw checkResult;
        }
        const aliceName = mpcSettings[0].name ?? "0";
        const bobName = mpcSettings[1].name ?? "1";
        if (name !== aliceName && name !== bobName) {
            throw new Error(`Unknown participant name: ${name}`);
        }
        return new EmpWasmSession(circuit, mpcSettings, input, send, name === aliceName);
    }
}
export function checkSettingsValidForEmpWasm(circuit, mpcSettings) {
    if (mpcSettings.length !== 2) {
        return new Error("EmpWasmBackend requires exactly two participants");
    }
    for (const participant of mpcSettings) {
        if (!checkStringSetsEqual(participant.outputs, Object.keys(circuit.info.output_name_to_wire_index))) {
            return new Error("Participant outputs do not match the circuit");
        }
        // Note: It's also possible for the garbler to get no outputs, but this is
        // not currently supported here.
    }
    return undefined;
}
function checkStringSetsEqual(a, b) {
    const setA = new Set(a);
    const setB = new Set(b);
    if (setA.size !== setB.size) {
        return false;
    }
    for (const elem of setA) {
        if (!setB.has(elem)) {
            return false;
        }
    }
    return true;
}
//# sourceMappingURL=EmpWasmBackend.js.map